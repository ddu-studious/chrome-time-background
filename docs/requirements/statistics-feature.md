# 任务统计功能规划

> 文档创建时间：2026-01-31

## 当前实现状态 (v1.5.2)

### 已实现功能

#### 1. 基础统计面板
- **位置**：侧边栏工具栏 → 统计按钮（图表图标）
- **触发方式**：点击弹出模态面板

#### 2. 日期范围选择
- 支持 7天 / 30天 / 90天 / 全部 四种范围
- 切换范围后数据实时刷新

#### 3. 统计卡片
| 指标 | 说明 |
|------|------|
| 总任务 | 选定范围内创建的任务数 |
| 已完成 | 已标记完成的任务数 |
| 待完成 | 未完成的任务数 |
| 已过期 | 超过截止日期但未完成 |

#### 4. 生产力评分
- **算法**：`完成率 × 0.7 + (1 - 过期率) × 0.3`
- **评级**：
  - ≥90：效率超高 🌟
  - ≥70：做得不错 💪
  - ≥50：有提升空间 🎯
  - <50：需要改进 📝

#### 5. 完成趋势图
- 纯 CSS 柱状图（无需外部库）
- 显示天数根据日期范围自动调整（最多14天）

#### 6. 优先级分布
- 高 / 中 / 低 / 无 四级
- 进度条可视化

#### 7. 分类分布
- 显示各分类的任务数和完成进度
- 进度条形式展示完成率

#### 8. 最近完成列表
- 显示最近完成的 5 个任务
- 相对时间显示（刚刚、X分钟前、X小时前等）

#### 9. 存储管理
- 显示当前存储使用量（KB）
- 显示配额占用百分比（10MB 配额）
- 一键清理已完成任务
- 一键清理图片数据

---

## 与独立统计页面 (task-statistics.html) 的差异

| 功能 | 内嵌面板 | 独立页面 | 差异原因 |
|------|---------|---------|---------|
| 图表库 | 纯 CSS | Chart.js | 内嵌面板不适合加载外部库 |
| 饼图/极坐标图 | ❌ | ✅ | Chart.js 依赖 |
| 日期范围选择 | ✅ | ✅ | 已对齐 |
| 优先级分布 | ✅ | ✅ | 已对齐 |
| 最近完成列表 | ✅ | ✅ | 已对齐 |
| 存储管理 | ✅ | ✅ | 已对齐 |
| 数据导出 | ❌ | ✅ | 功能定位不同 |

---

## 未来规划

### 短期优化 (v1.6.x)

1. **图表增强**
   - 考虑集成轻量级图表库（如 uPlot）
   - 或继续优化纯 CSS 图表的视觉效果

2. **更多维度统计**
   - 按标签统计
   - 按时间段（上午/下午/晚上）统计
   - 工作日 vs 周末完成率对比

3. **数据导出**
   - 支持导出 CSV 格式
   - 支持导出统计报告 PDF

### 中期规划 (v1.7.x)

1. **时间追踪**
   - 记录任务完成耗时
   - 显示平均完成时间

2. **目标设定**
   - 每日/每周任务目标
   - 目标完成进度追踪

3. **连续性统计**
   - 连续完成天数
   - 习惯养成追踪

### 长期愿景 (v2.x)

1. **智能分析**
   - 识别效率高峰时段
   - 推荐最佳任务安排

2. **同步与对比**
   - 多设备数据同步
   - 周/月报表自动生成

---

## 技术限制说明

### 为什么不使用 Chart.js？

1. **包体积**：Chart.js 压缩后约 60KB
2. **加载延迟**：需要额外的网络请求或内联
3. **Chrome 扩展限制**：Content Security Policy 限制外部脚本
4. **场景适配**：内嵌面板空间有限，复杂图表意义不大

### 推荐方案

- 内嵌面板：纯 CSS 图表，轻量快速
- 详细分析需求：引导用户打开独立统计页面
- 复杂可视化：考虑轻量库如 uPlot (约 25KB)

---

## 相关文件

- 内嵌统计面板：`js/memo.js` → `showTaskStatistics()`
- 独立统计页面：`test/task-statistics.html`
- 样式定义：`css/style.css` → `.stats-panel` 相关

---

**最后更新**: 2026-01-31
